@using Microsoft.AspNetCore.Http;
@using Nakheel_Web.Models.AccountsMaster;
@using Newtonsoft.Json;
@using static Nakheel_Web.Authentication.Common;
@inject IHttpContextAccessor HttpContextAccessor;
@{
    var str = HttpContextAccessor.HttpContext!.Session.GetString("Login");
    string Des = Decrypt(str!);
    Login_ LoginClass = JsonConvert.DeserializeObject<Login_>(Des!)!;
}
@{
    Layout = null;
}
@model Nakheel_Web.Models.Emergency.Mitigation_Report;
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.min.css" crossorigin="anonymous">
<link href="~/assets/libs/fileupload/fileinput.min.css" rel="stylesheet" />
<script src="~/assets/libs/fileupload/fileinput.min.js"></script>
<head>
    <style>
        label {
            font-weight: 500;
            font-family: 'Nakheel-Textregular' !important;
            font-size: 13px;
        }

        .tdtxt {
            color: #00617F;
        }

        .font-bold {
            color: #00263a !important;
        }
    </style>
    @*<style>
        .form-label, .form-control {
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-family: 'Nakheel-Textregular';
            font-size: 13px;
        }

        label {
            font-weight: 500;
            font-family: 'Nakheel-Textregular' !important;
            font-size: 13px;
        }

        table {
            font-family: 'Nakheel-Textregular';
        }

        span {
            font-weight: 500;
            font-family: 'Nakheel-Textregular';
            font-size: 15px;
        }

        .tdtxt {
            color: #00617F;
        }

        .font-bold {
            color: #00263a !important;
        }

        .table > :not(caption) > * > * {
            padding: 0.35rem 0.35rem !important;
            background-color: var(--bs-table-bg);
            border-bottom-width: 1px;
            -webkit-box-shadow: inset 0 0 0 9999px var(--bs-table-accent-bg);
            box-shadow: inset 0 0 0 9999px var(--bs-table-accent-bg);
        }

        .tblround {
            border-collapse: collapse;
            border-radius: 1em;
            overflow: hidden
        }
    </style>*@
</head>

<div id="View_Mitigation_Report_List">
    <div class="row">
        <div class="col-12">
            <div class="col-xxl-12 mb-5 mb-xxl-0">
                @if (Model.Remarks == "0")
                {
                    <form id="F_Mitigation" action="" method="post" class="row NotValid" novalidate="novalidate" enctype="multipart/form-data">

                        <div class="row mb-3">
                            @if (Model != null)
                            {
                                <input type="hidden" id="V_Trigger_Id" value="@Model.Trigger_ID" />
                            }
                            <input type="hidden" id="M_Createdby" value="@LoginClass.Employee_Identity_Id" />
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-5 col-form-label">Areas Of Rain<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="text" class="form-control" id="Area_Rain" name="Area_Rain" autocomplete="off" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-6 col-form-label">Time Of Rain Started<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="time" class="form-control" id="Rain_Start" name="Rain_Start" autocomplete="off" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-8 col-form-label">Time Of Rain Finished<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="time" class="form-control" id="Rain_Finish" name="Rain_Finish" autocomplete="off" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-5 col-form-label">Response Time<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="time" class="form-control" id="Response_Time" name="Response_Time" autocomplete="off" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-8 col-form-label">Duration Of Rain(In Mins)<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="number" min="0" class="form-control" id="Duration_Rain" name="Duration_Rain" autocomplete="off" oninput="validity.valid||(value='')" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-10 col-form-label">No Of Pumps Deployed With Sizes<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="text" class="form-control" id="Pumps" name="Pumps" autocomplete="off" oninput="validity.valid||(value='')" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-12 col-form-label">Duration Of Pumps Operated<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="number" min="0" class="form-control" id="Pumps_operated" name="Pumps_operated" autocomplete="off" oninput="validity.valid||(value='')" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-8 col-form-label">No Of Tankers Deployed <span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="number" min="0" class="form-control" id="Tankers" name="Tankers" autocomplete="off" oninput="validity.valid||(value='')" />
                                    </div>
                                </div>
                            </div>


                        </div>
                        <div class="row mb-3">
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-5 col-form-label">No Of Trips <span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="number" min="0" class="form-control" id="Trips" name="Trips" autocomplete="off" oninput="validity.valid||(value='')"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-6 col-form-label">Time To Clear Area<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="time" class="form-control" id="Clear_Area" name="Clear_Area" autocomplete="off" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-10 col-form-label">No Of Resources Deployed(SP)<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="number" min="0" class="form-control" id="Resource_SP" name="Resource_SP" autocomplete="off" oninput="validity.valid||(value='')"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-10 col-form-label">No Of Resources Deployed(NCM)<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="number" min="0" class="form-control" id="Resources_NCM" name="Resources_NCM" autocomplete="off" oninput="validity.valid||(value='')" />
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="row mb-3">
                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-8 col-form-label">Cost For Mitigation<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="number" min="0" class="form-control" id="Cost_Mitigation" name="Cost_Mitigation" autocomplete="off" oninput="validity.valid||(value='')" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-3">
                                <div class="">
                                    <label for="" class="col-md-10 col-form-label">Rain Gauge Reading - If Available<span class="requ">*</span> </label>
                                    <div class="form-group">
                                        <input type="number" min="0" class="form-control" id="RainGauage" name="RainGauage" autocomplete="off" oninput="validity.valid||(value='')" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="">
                                    <div class="form-group">
                                        <label for="" class="col-md-5 col-form-label">File Upload<span class="requ">*</span> </label>
                                        <div class="file-loading">
                                            <input id="inputPhoto" name="files" type="file" accept="image/*" multiple>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-5"></div>
                            <div class="col-md-7">
                                <button type="submit" class="btn btn-success waves-effect waves-light submit" id="">
                                    <i class="bx bx-check-double font-size-16 align-middle me-2"></i>Submit
                                </button>
                            </div>
                        </div>
                    </form>
                }
                else
                {
                    <div>
                        <table class="table tab">
                            <tbody>
                                <tr>
                                    <td><b class="font-bold">Areas Of Rain</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Area</td>

                                    <td><b class="font-bold">Time Of Rain Started</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Start_Time </td>

                                    <td><b class="font-bold">Time Of Rain Finished</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.End_Time</td>

                                    <td><b class="font-bold">Response Time </b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Resp_Time</td>
                                </tr>
                                <tr>
                                    <td><b class="font-bold">Duration Of Rain(In Mins)</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Duration </td>

                                    <td><b class="font-bold">No Of Pumps Deployed With Sizes</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Pumps_Deployed</td>

                                    <td><b class="font-bold">Duration Of Pumps Operated</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Pump_OP_Duration</td>

                                    <td><b class="font-bold">No Of Tankers Deployed </b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Tankers_Deployed</td>
                                </tr>
                                <tr>
                                    <td><b class="font-bold">No Of Trips</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.No_Trips</td>

                                    <td><b class="font-bold">Time To Clear Area</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Clear_Time</td>

                                    <td><b class="font-bold">No Of Resources Deployed(SP)</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Deployed_SP </td>

                                    <td><b class="font-bold">No Of Resources Deployed(NCM) </b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Deployed_NCM </td>
                                </tr>
                                <tr>
                                    <td><b class="font-bold">Cost For Mitigation</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Mitigation_Cost </td>

                                    <td><b class="font-bold">Rain Gauge Reading</b></td>
                                    <td>:</td>
                                    <td class="tdtxt">@Model.Gauge_Reading </td>

                                    <td><b class="font-bold">File Uploaded</b></td>
                                    <td>:</td>
                                    <td>
                                        @{
                                            if (Model._Files != null)
                                            {
                                                foreach (var item in Model._Files)
                                                {
                                                    <a href="@item.File_Path" target="_blank"><img src="@item.File_Path" alt="" width="50" height="60" /></a>
                                                }
                                            }
                                        }
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<script src="~/assets/js/emergency/emergencyalertvalidation.js"></script>
<script>
    $(function () {
        var $el1 = $("#inputPhoto");
        $el1.fileinput({
            allowedFileExtensions: ['jpg', 'png', 'jpeg', 'bmp'],
            uploadUrl: '/MigitationAction/SpotFileUpload',
            uploadAsync: false,
            //deleteUrl: '/Incident/DeletePhotoFiles',
            showRemove: false,
            showUpload: false, // hide upload button
            overwriteInitial: false, // append files to initial preview
            minFileCount: 1,
            maxFileCount: 5,
            browseOnZoneClick: true,
            initialPreviewAsData: true,
        }).on("filebatchselected", function (event, files) {
            $el1.fileinput("upload");
        });
    });
</script>