@using Microsoft.AspNetCore.Http;
@using Nakheel_Web.Models.AccountsMaster;
@using Newtonsoft.Json;
@using static Nakheel_Web.Authentication.Common;
@inject IHttpContextAccessor HttpContextAccessor;
@{
    var str = HttpContextAccessor.HttpContext!.Session.GetString("Login");
    string Des = Decrypt(str!);
    Login_ LoginClass = JsonConvert.DeserializeObject<Login_>(Des!)!;
}

@{
    ViewData["Title"] = "Non-Conformance Report";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .Find_width {
        width: 200px;
    }

    .error {
        color: red !important;
    }

    .select2-container--default.select2-container--open.select2-container--above .select2-selection--single, .select2-container--default.select2-container--open.select2-container--above .select2-selection--multiple {
        width: 252px !important;
    }

    .select2-container--default .select2-results > .select2-results__options {
        width: 252px !important;
        background-color: white !important;
    }

    .select2-container--default.select2-container--focus .select2-selection--multiple {
        width: 252px !important;
    }

    .select2-container--default .select2-selection--multiple {
        width: 252px !important;
    }

    .tblround {
        border-collapse: collapse;
        border-radius: 1em;
        overflow: hidden
    }

    .bg-darkcyan {
        background-color: darkcyan;
    }
</style>
<style>

    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
    }

    .controls {
        background-color: #fff;
        border-radius: 2px;
        border: 1px solid transparent;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        box-sizing: border-box;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        height: 29px;
        margin-left: 17px;
        margin-top: 10px;
        outline: none;
        padding: 0 11px 0 13px;
        text-overflow: ellipsis;
        width: 400px;
    }

        .controls:focus {
            border-color: #4d90fe;
        }

    .title {
        font-weight: bold;
    }

    #infowindow-!importantontent {
        display: none;
    }

    #map #infowindow-content {
        display: inline;
    }
</style>
<style>
    .pac-container {
        z-index: 100000;
    }
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.min.css" crossorigin="anonymous">
<div class="row" id="List_View_Div">
    <div class="col-xl-12">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-lg-10"> <h4 class="card-title">Non-Conformance Report</h4></div>
                    @if (LoginClass.Role_Id == "9" || LoginClass.Role_Id == "10" || LoginClass.Role_Id == "11")
                    {
                        <div class="col-lg-2">
                            <button type="button" class="btn btn-success waves-effect waves-light" style="float: right;" onclick="Fn_Create_NCR_Form()" id="btnadd_Violation"><i class="mdi mdi-plus me-1"></i> Raise NCR Report </button>
                        </div>
                    }
                    else
                    {
                        <div class="col-lg-2" style="padding:13px"></div>
                    }
                </div>
            </div>
            <div class="card-body">
                <table id="MainTable" class="table tblround table-sm table-striped dt-responsive" style="width:100%;">
                    <thead>
                        <tr class="">
                            <th style="text-align:left;">NCR ID</th>
                            <th style="text-align:left;">Audit ID</th>
                            <th style="text-align:left;">Zone</th>
                            <th style="text-align:left;">Community</th>
                            <th style="text-align:left;">Audit Type</th>
                            <th style="text-align:left;">Audit Date</th>
                            <th style="text-align:left;">HSE Officer</th>
                            <th style="text-align:left;">Status</th>
                            <th style="text-align:left;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="GetAllRequestList">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row" id="Create_NCR_Form_Div" style="display:none">
    <div class="preloader_add" style="display:none">
        <img style="width: 10%;text-align: center;margin-left: 39%;margin-top: 10%;" src="/assets/images/Loader_new.gif">
    </div>
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-lg-10"><h4>Non-Conformance Report</h4></div>
                    <div class="col-lg-2">
                        <button type="button" class="btn btn-success waves-effect btn_back_View waves-light" style="float: right;"><i class="mdi mdi-arrow-left-thin-circle-outline me-1"></i> Back </button>
                    </div>
                </div>
            </div>
            <form id="Fm_Add_Audit_NCM_Form">
            <div class="card-body">
                <div class="card-body Load_Create_NCR_Form_Div">
                </div>
            </div>
            </form>
        </div>
    </div>
</div>

<div class="row" id="Add_View_NCR_Form_Div" style="display:none">
    <div class="preloader_add" style="display:none">
        <img style="width: 10%;text-align: center;margin-left: 39%;margin-top: 10%;" src="/assets/images/Loader_new.gif">
    </div>
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-lg-10"><h4>Non-Conformance Report</h4></div>
                    <div class="col-lg-2">
                        <button type="button" class="btn btn-success waves-effect btn_back_View waves-light" style="float: right;"><i class="mdi mdi-arrow-left-thin-circle-outline me-1"></i> Back </button>
                    </div>
                </div>
            </div>
            <form id="Fm_Add_View_NCR_Form">
                <div class="card-body">
                    <div class="card-body Load_Add_View_NCR_Form_Div">
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>



<div class="modal fade Approve-NCR-Form-HSE-Manager" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myExtraLargeModalLabel">Approve Comments</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="FM_Approve_NCR_Form_HSE_Manager">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-12">
                                <textarea class="form-control" id="NCR_Form_App_Details" required></textarea>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div style="text-align:center;">
                            <button onclick="btn_NCR_Form_HSE_Manager_Approval('7')" type="button" class="btn btn_NCR_Form_HSE_Manager_Approval btn-success" id="btn-save-event"> Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>
<div class="modal fade Reject-NCR-Form-HSE-Manager" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myExtraLargeModalLabel">Reject Reason</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="FM_Reject_NCR_Form_HSE_Manager">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-12">
                                <textarea class="form-control" id="NCR_Form_Reject_Details" required></textarea>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div style="text-align:center;">
                            <button onclick="btn_NCR_Form_HSE_Manager_Approval('6')" type="button" class="btn btn_NCR_Form_HSE_Manager_Approval btn-success" id="btn-save-event"> Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>

<div class="modal fade Approve-NCR-Form-HSE-Dir" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myExtraLargeModalLabel">Approve Comments</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="FM_Approve_NCR_Form_HSE_Dir">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-12">
                                <textarea class="form-control" id="NCR_Form_Dir_App_Details" required></textarea>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div style="text-align:center;">
                            <button onclick="btn_NCR_Form_Dir_Manager_Approval('30')" type="button" class="btn btn_NCR_Form_Dir_Manager_Approval btn-success" id="btn-save-event"> Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>
<div class="modal fade Reject-NCR-Form-Dir-Manager" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myExtraLargeModalLabel">Reject Reason</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="FM_Reject_NCR_Form_Dir_Manager">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-12">
                                <textarea class="form-control" id="NCR_Form_Dir_Reject_Details" required></textarea>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div style="text-align:center;">
                            <button onclick="btn_NCR_Form_Dir_Manager_Approval('8')" type="button" class="btn btn_NCR_Form_Dir_Manager_Approval btn-success" id="btn-save-event"> Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>

<div class="modal fade Reject-NCR-Lead-Auditor" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myExtraLargeModalLabel">Reject Reason</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="FM_Reject_NCR_Lead_Auditor">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-12">
                                <textarea class="form-control" id="NCR_Form_Rej_Lead_Auditor_Details" required></textarea>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div style="text-align:center;">
                            <button onclick="btn_NCR_Lead_Auditor_Approval('2')" type="button" class="btn btn_NCR_Lead_Auditor_Approval btn-success" id="btn-save-event"> Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>
<div class="modal fade Approve-NCR-Lead-Auditor" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myExtraLargeModalLabel">Approve Comments</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="FM_Approve_NCR_Form_Lead_Auditor">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-12">
                                <textarea class="form-control" id="NCR_Form_App_Lead_Auditor_Details" required></textarea>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div style="text-align:center;">
                            <button onclick="btn_NCR_Lead_Auditor_Approval('9')" type="button" class="btn btn_NCR_Lead_Auditor_Approval btn-success" id="btn-save-event"> Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>

<div class="modal fade Reject-NCR-HSE-Manager" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myExtraLargeModalLabel">Reject Reason</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="FM_Reject_NCR_HSE_Manager">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-12">
                                <textarea class="form-control" id="NCR_Reject_HSE_Manager_Details" required></textarea>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div style="text-align:center;">
                            <button onclick="btn_NCR_HSE_Manager_Approval('10')" type="button" class="btn btn_NCR_HSE_Manager_Approval btn-success" id="btn-save-event"> Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>
<div class="modal fade Final-Approve-NCR-HSE-Manager" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myExtraLargeModalLabel">Approve Comments</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="FM_Approve_NCR_Form_HSE_Manager_Final">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-12">
                                <textarea class="form-control" id="NCR_Form_Final_Approve_Details" required></textarea>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div style="text-align:center;">
                            <button onclick="btn_NCR_HSE_Manager_Approval('3')" type="button" class="btn btn_NCR_HSE_Manager_Approval btn-success" id="btn-save-event"> Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>








<script src="~/assets/js/validation/audit_ncm_form/auditncmseverside.js"></script>
<script src="~/assets/js/validation/audit_ncm_form/auditncmvalidation.js"></script>
<script>
    "use strict";
    const UI_Fields = Object.freeze({
        List_View_Div: "#List_View_Div",
        TBODY_TABLE: "#GetAllRequestList",
        MainTable: "#MainTable",
        BTN_BACK: "#btn_back",
        btn_back_View: ".btn_back_View",
        Create_NCR_Form_Div: "#Create_NCR_Form_Div",
        Load_Create_NCR_Form_Div: ".Load_Create_NCR_Form_Div",
        Add_View_NCR_Form_Div: "#Add_View_NCR_Form_Div",
        Load_Add_View_NCR_Form_Div: ".Load_Add_View_NCR_Form_Div",
    });
    $(document).ready(function () {
        let msg = '@TempData["msg"]';
        if (msg != "") {
            if (msg == "Added Successful" || msg == "Updated Successfully" || msg == "Approved Successfully" || msg == "Rejected Successfully" || msg == "Added Successfully") {
                Swal.fire({
                    position: 'Center',
                    icon: 'success',
                    title: msg,
                    showConfirmButton: false,
                    timer: 1500
                });
            }
            else {
                Swal.fire({
                    position: 'Center',
                    icon: 'warning',
                    title: msg,
                    showConfirmButton: false,
                    timer: 2000
                });
            }
        }
        ServerSideTable_Request();

        $(UI_Fields.BTN_BACK).click(function () {
            window.location.reload();
        });
        $(UI_Fields.btn_back_View).click(function () {
            window.location.reload();
        });

    });
    
    function Fn_Create_NCR_Form(){
        $(UI_Fields.List_View_Div).hide(100);
        $(UI_Fields.Create_NCR_Form_Div).show(100);

        $.post("@Url.Action("P_Create_Audit_NCM_Form", "AuditNCMForm")", function (data) {
            $(UI_Fields.Load_Create_NCR_Form_Div).html('');
            $(UI_Fields.Load_Create_NCR_Form_Div).html(data);
        });
    }
    function Fn_Zone(Zone_Id) {
        debugger
        $("#Community_Id").empty();
        $("#Service_Provider_Id").empty();
        $.post("@Url.Action("LoadAllCommunitybyZone", "CommonMaster")", { Zone_Id: Zone_Id }, function (data) {
            $("#Community_Id").append("<option selected value=''style='text-align:center'  disabled>--Select--</option>");
            $(data).each(function (i, e) {
                $("#Community_Id").append("<option value=" + e.Community_Master_Id + ">" + e.Community_Master_Name + "</option>");
            });
        });
    }
    function Fn_Community(Community_Id) {
        var Zone_Id = $("#Zone_Id").val();
        $.post("@Url.Action("Insp_LoadAllServiceProvider", "Inspection")", { Zone_Id: Zone_Id, Community_Id: Community_Id }, function (data) {
            $("#Service_Provider_Id").empty();
            $("#Service_Provider_Id").append("<option selected value=''style='text-align:center'  disabled>--Select--</option>");
            $(data).each(function (i, e) {
                $("#Service_Provider_Id").append("<option value=" + e.Employee_Identity_Id + ">" + e.First_Name + "</option>");
            });
        });
    }

    function Edit(id, Name, Access) {
        if (Name == "View") {
            $(UI_Fields.List_View_Div).hide(100);
            $(UI_Fields.Add_View_NCR_Form_Div).show(100);

            $.post("@Url.Action("P_Audit_NCM_Form_AddView", "AuditNCMForm")", { ID: id }, function (data) {
                $(UI_Fields.Load_Add_View_NCR_Form_Div).html('');
                $(UI_Fields.Load_Add_View_NCR_Form_Div).html(data);
            });

        } else {
            $(UI_Fields.List_View_Div).hide(100);
            $(UI_Fields.Add_View_NCR_Form_Div).show(100);

            $.post("@Url.Action("P_Audit_NCM_Form_AddView", "AuditNCMForm")", { ID: id }, function (data) {
                $(UI_Fields.Load_Add_View_NCR_Form_Div).html('');
                $(UI_Fields.Load_Add_View_NCR_Form_Div).html(data);
            });
        }
    }

    function btn_NCR_HSE_Manager_Approval(Name) {
        $('.btn_NCR_HSE_Manager_Approval').attr('disabled','disabled');
        if (Name == "3") {
            let valid = $("#FM_Approve_NCR_Form_HSE_Manager_Final").valid();
            if (!valid) {
                $('.btn_NCR_HSE_Manager_Approval').removeAttr('disabled');
                return false;
            }

            var Remarks = $("#NCR_Form_Final_Approve_Details").val();
            var Am_Sp_NCR_Id = $("#Am_Sp_NCR_Id").val();
            var Status = "3";
            $.post("@Url.Action("Audit_NCM_CA_Action_HSE_ApprovalReject", "AuditNCMForm")", { Am_Sp_NCR_Id: Am_Sp_NCR_Id, Remarks: Remarks, Status: Status }, function (data) {
                if (data == "200") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Approved Successfully',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    $('.btn_NCR_HSE_Manager_Approval').removeAttr('disabled');
                    Swal.fire({
                        position: 'top-end',
                        icon: 'Error',
                        title: 'Error',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        } else {
            let valid = $("#FM_Reject_NCR_HSE_Manager").valid();
            if (!valid) {
                $('.btn_NCR_HSE_Manager_Approval').removeAttr('disabled');
                return false;
            }
            var Remarks = $("#NCR_Reject_HSE_Manager_Details").val();
            var Am_Sp_NCR_Id = $("#Am_Sp_NCR_Id").val();
            var Status = "10";
            $.post("@Url.Action("Audit_NCM_CA_Action_HSE_ApprovalReject", "AuditNCMForm")", { Am_Sp_NCR_Id: Am_Sp_NCR_Id, Remarks: Remarks, Status: Status }, function (data) {
                if (data == "200") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Rejected Successfully',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    $('.btn_NCR_HSE_Manager_Approval').removeAttr('disabled');
                    Swal.fire({
                        position: 'top-end',
                        icon: 'Error',
                        title: 'Error',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        }
    }

    function btn_NCR_Form_HSE_Manager_Approval(Name) {
        $('.btn_NCR_Form_HSE_Manager_Approval').attr('disabled', 'disabled');
        if (Name == "7") {
            let valid = $("#FM_Approve_NCR_Form_HSE_Manager").valid();
            if (!valid) {
                $('.btn_NCR_Form_HSE_Manager_Approval').removeAttr('disabled');
                return false;
            }

            var Remarks = $("#NCR_Form_App_Details").val();
            var Am_Sp_NCR_Id = $("#Am_Sp_NCR_Id").val();
            var Status = "7";
            $.post("@Url.Action("Audit_NCM_Form_HSE_ApprovalReject", "AuditNCMForm")", { Am_Sp_NCR_Id: Am_Sp_NCR_Id, Remarks: Remarks, Status: Status }, function (data) {
                if (data == "200") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Approved Successfully',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    $('.btn_NCR_Form_HSE_Manager_Approval').removeAttr('disabled');
                    Swal.fire({
                        position: 'top-end',
                        icon: 'Error',
                        title: 'Error',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        } else {
            let valid = $("#FM_Reject_NCR_Form_HSE_Manager").valid();
            if (!valid) {
                $('.btn_NCR_Form_HSE_Manager_Approval').removeAttr('disabled');
                return false;
            }
            var Remarks = $("#NCR_Form_Reject_Details").val();
            var Am_Sp_NCR_Id = $("#Am_Sp_NCR_Id").val();
            var Status = "6";
            $.post("@Url.Action("Audit_NCM_Form_HSE_ApprovalReject", "AuditNCMForm")", { Am_Sp_NCR_Id: Am_Sp_NCR_Id, Remarks: Remarks, Status: Status }, function (data) {
                if (data == "200") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Rejected Successfully',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    $('.btn_NCR_Form_HSE_Manager_Approval').removeAttr('disabled');
                    Swal.fire({
                        position: 'top-end',
                        icon: 'Error',
                        title: 'Error',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        }
    }

    function btn_NCR_Form_Dir_Manager_Approval(Name) {
        $('.btn_NCR_Form_Dir_Manager_Approval').attr('disabled', 'disabled');
        if (Name == "30") {
            
            let valid = $("#FM_Approve_NCR_Form_HSE_Dir").valid();
            if (!valid) {
                $('.btn_NCR_Form_Dir_Manager_Approval').removeAttr('disabled');
                return false;
            }
            var Remarks = $("#NCR_Form_Dir_App_Details").val();
            var Am_Sp_NCR_Id = $("#Am_Sp_NCR_Id").val();
            var Status = "30";
            $.post("@Url.Action("Audit_NCM_Form_Dir_ApprovalReject", "AuditNCMForm")", { Am_Sp_NCR_Id: Am_Sp_NCR_Id, Remarks: Remarks, Status: Status }, function (data) {
                if (data == "200") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Approved Successfully',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    $('.btn_NCR_Form_Dir_Manager_Approval').removeAttr('disabled');
                    Swal.fire({
                        position: 'top-end',
                        icon: 'Error',
                        title: 'Error',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        } else {
            let valid = $("#FM_Reject_NCR_Form_Dir_Manager").valid();
            if (!valid) {
                $('.btn_NCR_Form_Dir_Manager_Approval').removeAttr('disabled');
                return false;
            }
            var Remarks = $("#NCR_Form_Dir_Reject_Details").val();
            var Am_Sp_NCR_Id = $("#Am_Sp_NCR_Id").val();
            var Status = "8";
            $.post("@Url.Action("Audit_NCM_Form_Dir_ApprovalReject", "AuditNCMForm")", { Am_Sp_NCR_Id: Am_Sp_NCR_Id, Remarks: Remarks, Status: Status }, function (data) {
                if (data == "200") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Rejected Successfully',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    $('.btn_NCR_Form_Dir_Manager_Approval').removeAttr('disabled');
                    Swal.fire({
                        position: 'top-end',
                        icon: 'Error',
                        title: 'Error',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        }
    }

    function btn_NCR_Lead_Auditor_Approval(Name) {
        $('.btn_NCR_Lead_Auditor_Approval').attr('disabled', 'disabled');
        if (Name == "9") {
            let valid = $("#FM_Approve_NCR_Form_Lead_Auditor").valid();
            if (!valid) {
                $('.btn_NCR_Lead_Auditor_Approval').removeAttr('disabled');
                return false;
            }

            var Remarks = $("#NCR_Form_App_Lead_Auditor_Details").val();
            var Am_Sp_NCR_Id = $("#Am_Sp_NCR_Id").val();
            var Status = "9";
            $.post("@Url.Action("NCM_CA_Action_Lead_Auditor_ApprovalReject", "AuditNCMForm")", { Am_Sp_NCR_Id: Am_Sp_NCR_Id, Remarks: Remarks, Status: Status }, function (data) {
                if (data == "200") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Approved Successfully',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    $('.btn_NCR_Lead_Auditor_Approval').removeAttr('disabled');
                    Swal.fire({
                        position: 'top-end',
                        icon: 'Error',
                        title: 'Error',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        } else {
            let valid = $("#FM_Reject_NCR_Lead_Auditor").valid();
            if (!valid) {
                $('.btn_NCR_Lead_Auditor_Approval').removeAttr('disabled');
                return false;
            }
            var Remarks = $("#NCR_Form_Rej_Lead_Auditor_Details").val();
            var Am_Sp_NCR_Id = $("#Am_Sp_NCR_Id").val();
            var Status = "2";
            $.post("@Url.Action("NCM_CA_Action_Lead_Auditor_ApprovalReject", "AuditNCMForm")", { Am_Sp_NCR_Id: Am_Sp_NCR_Id, Remarks: Remarks, Status: Status }, function (data) {
                if (data == "200") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Rejected Successfully',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    $('.btn_NCR_Lead_Auditor_Approval').removeAttr('disabled');
                    Swal.fire({
                        position: 'top-end',
                        icon: 'Error',
                        title: 'Error',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        }
    }

</script>
