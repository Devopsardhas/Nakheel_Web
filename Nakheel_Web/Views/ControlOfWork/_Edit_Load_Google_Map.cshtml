@{
    Layout = null;
}
@model Nakheel_Web.Models.ControlOfWorkMaster.Ptw_Confined_Space_Add
<style>

    #map {
        height: 100%;
    }

    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
    }

    .controls {
        background-color: #fff;
        border-radius: 2px;
        border: 1px solid transparent;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        box-sizing: border-box;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        height: 29px;
        margin-left: 17px;
        margin-top: 10px;
        outline: none;
        padding: 0 11px 0 13px;
        text-overflow: ellipsis;
        width: 400px;
    }

        .controls:focus {
            border-color: #4d90fe;
        }

    .title {
        font-weight: bold;
    }

    #infowindow-content {
        display: none;
    }

    #map #infowindow-content {
        display: inline;
    }
</style>

<style>
    #map-canvas {
        height: 300px;
        width: 100%;
        border-radius: 14px;
    }

    #search_input {
        font-size: 18px;
        width: 430px;
        height: 40px;
        margin: 10px;
        padding: 10px;
        box-sizing: border-box;
        border-radius: 10px;
        font-family: 'Nakheel-Textregular';
    }

    #search_input_1 {
        font-size: 18px;
        width: 330px;
        height: 40px;
        margin: 10px;
        padding: 10px;
        box-sizing: border-box;
        border-radius: 10px;
        font-family: 'Nakheel-Textregular';
    }

</style>
@if(Model != null)
{
    <div class="row">
        <input type="text" id="search_input" value="@Model.Location_Address" placeholder="Search for a Location" name="Location" />
        <input type="text" id="search_input_1" value="@Model.Exact_Loc_Address" placeholder="Exact Location" name="Location_5" />
        <input type="hidden" value="@Model.Latitude" id="lat_dynamic" />
        <input type="hidden" value="@Model.Longitude" id="Long_dynamic" />
        <div id="information" style="display:none"></div>
        <div id="map-canvas"></div>
    </div>
}
<script>
    if (document.getElementById('map-canvas')) {
        debugger;
        var content;
        var latitude = $("#lat_dynamic").val();
        var longitude = $("#Long_dynamic").val();
        var map;
        var marker;
        var geocoder;
        navigator.geolocation.getCurrentPosition(loadMap);

        function loadMap(location) {
            if (location.coords) {
                latitude = location.coords.latitude;
                longitude = location.coords.longitude;
            }

            // Coordinates to center the map
            var myLatlng = new google.maps.LatLng(latitude, longitude);
            geocoder = new google.maps.Geocoder();
            // Other options for the map, pretty much selfexplanatory
            var mapOptions = {
                zoom: 12,
                center: myLatlng,//new google.maps.LatLng(25.1143122, 55.1387501),
                mapTypeId: google.maps.MapTypeId.PLAN,
            };

            // Attach a map to the DOM Element, with the defined settings
            map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

            content = document.getElementById('information');
            google.maps.event.addListener(map, 'click', function (e) {
                placeMarker(e.latLng);
            });

            var input = document.getElementById('search_input');
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

            var input_1 = document.getElementById('search_input_1');
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(input_1);

            var searchBox = new google.maps.places.SearchBox(input);
            var image = '../assets/images/mappin.png';
            google.maps.event.addListener(searchBox, 'places_changed', function () {
                debugger
                var places = searchBox.getPlaces();
                placeMarker(places[0].geometry.location);
            });

            marker = new google.maps.Marker({
                position: myLatlng,
                map: map,
                animation: google.maps.Animation.DROP,
                icon: image
            });
        }
    }
    function placeMarker(location) {
        //geocodePosition(marker.getPosition());
        $("#lat_dynamic").val();
        $("#Long_dynamic").val();
        marker.setPosition(location);
        map.setCenter(location);
        marker.setMap(map);
        content.innerHTML = "";
        $("#Lat").val(location.lat());
        $("#Long").val(location.lng());
        $("#lat_dynamic").val(location.lat());
        $("#Long_dynamic").val(location.lng());

        content.innerHTML = "Lat: " + location.lat() + " / Long: " + location.lng();
        google.maps.event.addListener(marker, 'click', function (e) {
            debugger
            new google.maps.InfoWindow({
                content: "Lat: " + location.lat() + " / Long: " + location.lng()
            }).open(map, marker);
        });
        getAddress(location);
        //marker.setMap(null);
    }
    function getAddress(latLng) {
        var Loc_Add = "";
        geocoder.geocode({ 'latLng': latLng },
            function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[0]) {
                        map.setCenter(results[0].formatted_address);
                        Loc_Add = results[0].formatted_address;
                        $("#search_input").val(Loc_Add);
                    }
                    else {
                        $("#search_input").val(Loc_Add);
                    }
                }
                else {
                    $("#search_input").val(Loc_Add);
                }
            });
    }


</script>


